<!DOCTYPE html>
<html>

<head>
	<!-- Meta -->
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
	<meta name="generator" content="Jekyll">

	<title>Building R Shiny Applications</title>
  <meta name="description" content="A blog about data science and technology">

	<!-- CSS & fonts -->
	<link rel="stylesheet" href="/css/main.css">

	<!-- RSS -->
	<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" />

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/png" href="img/favicon.png">

</head>


<body>
	<div id="wrap">
	  	
	  	<!-- Navigation -->
	  	<nav id="nav">
	<div id="nav-list">
		<a href="/">Home</a>

		<!-- Nav pages -->
	  
	    
	  
	    
	      <a href="/About" title="About">About</a>
	    
	  
	    
	      <a href="/Apps" title="Apps">Apps</a>
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
    
    <!-- Nav links -->
	  <a href="https://www.linkedin.com/in/tianweizhang/">LinkedIn</a>
<a href="https://github.com/tianwei-zhang">Project on Github</a>


	</div>
  
  <!-- Nav footer -->
	
	  <footer>
	
	<span>version 1.0.0</span>

</footer>
	

</nav>

    
    <!-- Icon menu -->
	  <a id="nav-menu">
	  	<div id="menu"></div>
	  </a>

      <!-- Header -->
      
        <header id="header" class="parent justify-spaceBetween">
  <div class="inner w100 relative">
    <span class="f-left">
      <a href="/">
        <h1>
          <span>Tianwei</span>Zhang
        </h1>
      </a>
    </span>
    <span id="nav-links" class="absolute right bottom">
      <!-- Nav pages -->
	    
	      
	    
	      
	        <a href="/About" title="About">About</a>
	      
	    
	      
	        <a href="/Apps" title="Apps">Apps</a>
	      
	    
	      
	    
	      
	    
	      
	    
	      
	    
	      
	    

      <!-- Nav links -->
	    <a href="https://www.linkedin.com/in/tianweizhang/">LinkedIn</a>
<a href="https://github.com/tianwei-zhang">Project on Github</a>


    </span>
  </div>
</header>

      

    <!-- Main content -->
	  <div id="container">
		  
		<main>

			<article id="post-page">
	<h2>Building R Shiny Applications</h2>		
	<time datetime="2015-04-19T00:00:00-04:00" class="by-line">19 Apr 2015</time>
	<div class="content">

		<p><a href="http://shiny.rstudio.com">R Shiny</a> is a platform developed by RStudio that enables R users to develop <strong>interactive</strong> web applications without involving HTML or other programming languages.</p>

<p>##Getting Started
First, we need to install the shiny package.</p>
<pre><code>install.packages('shiny')</code></pre>
<p>For every shiny app, there are two core components: <strong>ui.R</strong> and <strong>server.R</strong>. Roughly speaking, ui.R collects inputs and defines the look and feel of the app, and server.R determines outputs and performs all the backend calculations. In this tutorial, we will learn how to build a simple R Shiny app.</p>

<p><img src="/assets/shiny1.jpg" alt="Demo App Screenshot" /></p>

<p>Let’s construct our first Shiny app!</p>

<!--more-->

<p>##Constructing UI
For simple applications, ui.R and server.R are almost completely separate pieces. One can start building the UI component without worrying about the backend calculation. For now, let’s only add the following lines to server.R</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#server.R
library(shiny)
shinyServer(function(input, output) {
})
</code></pre></div></div>

<p>For this tutorial, we want to build an app with a sidebar for inputs on the left and display output on the right.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#ui.R
library(shiny)
shinyUI(
  pageWithSidebar(
    headerPanel('Hello World'),
    sidebarPanel(),
    mainPanel()
    )
  )
</code></pre></div></div>
<p>There are three hierarchy levels found in the code above.</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">shinyUI()</code> is always required.</p>

    <ul>
      <li><code class="highlighter-rouge">pageWithSidebar()</code> specifies the page template, in this case a page with a sidebar consisted of three panels.
        <ul>
          <li><code class="highlighter-rouge">headerPanel</code> prints a title.</li>
          <li><code class="highlighter-rouge">sidebarPanel</code> constructs a sidebar on the left.</li>
          <li><code class="highlighter-rouge">mainPanel</code> outputs a large panel on the right.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>If we run the code above, our app looks like this:
<img src="/assets/shiny2.tiff" alt="Demo App Screenshot2" /></p>

<p>#Sidebar/Input
Next, let’s add user input options to the sidebar. We want to use two dropdown menus to allow users to select a vendor and a customer. In order to do so, we add <code class="highlighter-rouge">selectInput</code> to the <code class="highlighter-rouge">sidebarPanel</code>. The first string (e.g. ‘selected_vendor’) is the variable name for that user input. For example, if user selects ‘Vendor 1’, <code class="highlighter-rouge">input$selected_vendor</code> will equal to ‘Vendor 1’. The second string (e.g. ‘Vendor: ‘) will be printed before the dropdown menu. The last component lists the available options.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#ui.R
library(shiny)
shinyUI(
  pageWithSidebar(
    headerPanel('Hello World'),
    sidebarPanel(
      selectInput('selected_vendor','Vendor: ',c('Vendor 1', 'Vendor 2')),
      selectInput('selected_customer','Customer: ',c('Customer 1', 'Customer 2'))
      ),
    mainPanel()
    )
  )
</code></pre></div></div>

<p><img src="/assets/shiny3.png" alt="Demo App Screenshot3" /></p>

<p>We can add a slider bar using the following code:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> sliderInput('a_number','Select a Number: ',min=1,max=100,value=50)
</code></pre></div></div>
<p><img src="/assets/shiny4.tiff" alt="Demo App Screenshot4" /></p>

<p>#Output
Now let’s talk about how to construct the output. In this case, let’s start with a plot in the <code class="highlighter-rouge">mainPanel</code>. To do so, we add the following part to ui.R.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mainPanel(
  plotOutput('plot1')
)
</code></pre></div></div>

<p>Since we want to output a plot, we use <code class="highlighter-rouge">plotOutput</code>. There are different types of outputs available for R Shiny. For example, you can print a table with <code class="highlighter-rouge">tableOutput</code> or a html file with <code class="highlighter-rouge">htmlOutput</code>. The string ‘plot1’ is the name for this output that we will refer to later.</p>

<p>In order to generate the output, let’s switch to server.R.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#server.R
library(shiny)
library(ggplot2)

shinyServer(function(input, output) {

  output$plot1=renderPlot({
    qplot(1:9,1:9)
  })
  
})
</code></pre></div></div>

<p>You can use any graphing packages such as <a href="http://ggplot2.org">ggplot2</a> or <a href="http://rcharts.io">rCharts</a>, just load the packages at the beginning of the code. As you can see, there are two “input variables” for <code class="highlighter-rouge">shinyServer</code>, <strong>input</strong> and <strong>output</strong>. We can access the user inputs (e.g. vendor and customer) via input$variable_name. In this tutorial, we can call the user selected vendor and customer via <code class="highlighter-rouge">input$selected_vendor</code> and <code class="highlighter-rouge">input$selected_customer</code> (recall that selected_vendor and selected_customer are the names we gave to dropdown menus). <strong>Output</strong> is the collective list where all outputs are stored. <code class="highlighter-rouge">output$plot1=renderPlot({})</code> tells the program that plot1 is a graph and it is going to be rendered according to the R code within the brackets.</p>

<p><img src="/assets/shiny5.tiff" alt="Demo App Screenshot5" /></p>

<p>To make our app more exciting and useful, let’s make our output reactive to the user input. We can refer to any existing files (e.g. csv, Excel) in our shiny app. I added a csv file named masked_sales_opportunity_0501.csv in the same directory as ui.R and server.R. The first few lines are displayed below.</p>

<table>
  <thead>
    <tr>
      <th>CUSTOMER_NAME</th>
      <th>VENDOR_NAME</th>
      <th>MASTER_PRODCAT</th>
      <th>NETAMT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Customer 1</td>
      <td>Vendor 1</td>
      <td>Product Category 1</td>
      <td>4437</td>
    </tr>
    <tr>
      <td>Customer 10</td>
      <td>Vendor 1</td>
      <td>Product Category 1</td>
      <td>14794</td>
    </tr>
    <tr>
      <td>Customer 11</td>
      <td>Vendor 1</td>
      <td>Product Category 1</td>
      <td>4575</td>
    </tr>
    <tr>
      <td>Customer 13</td>
      <td>Vendor 1</td>
      <td>Product Category 1</td>
      <td>93</td>
    </tr>
    <tr>
      <td>Customer 14</td>
      <td>Vendor 1</td>
      <td>Product Category 1</td>
      <td>2921</td>
    </tr>
    <tr>
      <td>Customer 15</td>
      <td>Vendor 1</td>
      <td>Product Category 1</td>
      <td>4742</td>
    </tr>
    <tr>
      <td>Customer 17</td>
      <td>Vendor 1</td>
      <td>Product Category 1</td>
      <td>7406</td>
    </tr>
  </tbody>
</table>

<p>It has 20 unique customers and 10 unique vendors. Now we want to select a subset of the data and plot a histogram of NETAMT.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>library(shiny)
library(ggplot2)

data=read.csv('masked_sales_opportunity_0501.csv',header=TRUE)
shinyServer(function(input, output) {
  
  selectData=reactive({
    subdata=data[which(data$VENDOR_NAME==input$selected_vendor &amp;
                       data$CUSTOMER_NAME==input$selected_customer),]
    return(subdata)
  })    
  
  output$plot=renderPlot({
   data=selectData()
   hist(data$NETAMT)
  })

})
</code></pre></div></div>
<p>Notice that <code class="highlighter-rouge">selectData</code> is a function using the <code class="highlighter-rouge">reactive({})</code> wrap. <strong>Reactivity</strong> is a key concept in R Shiny. It means that the returned object will react to user inputs. If I invoke input variables without wrapping it in a reactive environment like in the following code,</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#Incorrect code
library(shiny)
library(ggplot2)

data=read.csv('masked_sales_opportunity_0501.csv',header=TRUE)
shinyServer(function(input, output) {
    
    subdata=data[which(data$VENDOR_NAME==input$selected_vendor &amp;
                       data$CUSTOMER_NAME==input$selected_customer),]

  output$plot=renderPlot({
  
    })

})
</code></pre></div></div>
<p>it will output an error.</p>
<blockquote>
  <p>Error in .getReactiveEnvironment()$currentContext() : 
  Operation not allowed without an active reactive context. (You tried to do something that can only be done from inside a reactive expression or observer.)</p>
</blockquote>

<p>With the correct code, this is what we have:</p>

<p><img src="/assets/shiny6.tiff" alt="Demo App Screenshot6" /></p>

<p><img src="/assets/shiny7.tiff" alt="Demo App Screenshot7" /></p>


		<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'tianwei-zhang';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</div>
</article>



	  </main>
		
		  <!-- Pagination links -->
      

	  </div>
	    
	    <!-- Footer -->
	    <footer><span>@2018 - Tianwei Zhang</span></footer>


	    <!-- Script -->
      <script src="/js/main.js"></script>	


	</div>
</body>
</html>
